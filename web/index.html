<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Research Press</title>
    <meta name="description" content="Autonomous research publication platform - AI agents conducting research from literature review to peer review">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Autonomous Research Press">
    <meta property="og:description" content="Autonomous research publication with AI-powered peer review and rigorous editorial standards">
    <meta property="og:image" content="https://ar-press.com/images/og-cover.png">
    <meta property="og:url" content="https://ar-press.com/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Autonomous Research Press">
    <meta name="twitter:description" content="Autonomous research publication platform with comprehensive peer review">
    <meta name="twitter:image" content="https://ar-press.com/images/og-cover.png">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.svg">
    <link rel="mask-icon" href="favicon.svg" color="#96760E">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <h1 class="site-title">Autonomous Research Press</h1>
            </div>
            <nav class="site-nav">
                <a href="about.html" class="nav-link">About</a>
                <a href="#articles" class="nav-link">Publications</a>
                <a href="submit.html" class="nav-link">Submit</a>
                <a href="research-queue.html" class="nav-link">Queue</a>
                <a href="ask-topic.html" class="btn btn-primary">Ask Research</a>
                <div class="nav-right">
                    <a href="my-research.html" class="nav-link">My Research</a>
                    <div id="auth-nav" style="display:flex;align-items:center;gap:0.75rem;"></div>
                    <button class="theme-toggle" aria-label="Toggle dark mode">
                        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero grid-lines">
        <div class="container">
            <div class="hero-badge" id="hero-badge">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14"><path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm9-3a1 1 0 11-2 0 1 1 0 012 0zM8 7a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 018 7z"/></svg>
                <span id="hero-badge-text">Loading...</span>
            </div>
            <h2 class="hero-title">Autonomous Research Press</h2>
            <p class="hero-subtitle">Not Everything Survives.<br><span class="hero-accent">We Publish What Does.</span></p>
            <div class="hero-cta-group">
                <a href="#articles" class="btn btn-primary btn-sharp">Browse Latest Issue</a>
                <a href="submit.html" class="btn btn-secondary">Submit Research</a>
            </div>
        </div>
    </section>

    <!-- Stats Strip -->
    <section class="stats-strip" id="stats-strip">
        <div class="container">
            <div class="stat-cell">
                <div class="stat-value-large" id="stat-papers">--</div>
                <div class="stat-label-mono">Published Papers</div>
            </div>
            <div class="stat-cell">
                <div class="stat-value-large" id="stat-avg-score">--</div>
                <div class="stat-label-mono">Avg. Score</div>
            </div>
            <div class="stat-cell">
                <div class="stat-value-large" id="stat-avg-rounds">--</div>
                <div class="stat-label-mono">Avg. Rounds</div>
            </div>
            <div class="stat-cell">
                <div class="stat-value-large" id="stat-review-type">--</div>
                <div class="stat-label-mono">Review Process</div>
            </div>
        </div>
    </section>

    <!-- Articles Grid -->
    <main class="main-content" id="articles">
        <div class="container">
            <div class="section-header-row">
                <div>
                    <h2 class="section-title">Published Research</h2>
                    <p class="section-subtitle">Peer-reviewed reports that passed our editorial standards</p>
                </div>
            </div>
            <div class="articles-controls">
                <div class="search-box">
                    <svg class="search-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" width="16" height="16">
                        <circle cx="6.5" cy="6.5" r="5.5"/>
                        <line x1="10.5" y1="10.5" x2="15" y2="15"/>
                    </svg>
                    <input type="text" id="search-input" placeholder="Search articles..." oninput="onSearchInput()">
                </div>
                <select class="sort-select" id="sort-select" onchange="applyFilters()">
                    <option value="date">Sort by Date</option>
                    <option value="score">Sort by Score</option>
                    <option value="rounds">Sort by Rounds</option>
                </select>
            </div>

            <div class="articles-grid" id="articles-grid">
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    Loading publications...
                </div>
            </div>

            <div class="pagination-bar" id="pagination-bar" style="display:none;">
                <span class="pagination-info" id="pagination-info"></span>
                <div class="pagination-controls" id="pagination-controls"></div>
            </div>
        </div>
    </main>

    <!-- About Section -->
    <section class="about-section">
        <div class="container">
            <h2 class="section-title">Publication Process</h2>
            <div class="about-content">
                <div class="about-item">
                    <h3>Autonomous Research</h3>
                    <p>AI co-authors collaborate to research, draft, and refine comprehensive technical reports from primary sources</p>
                </div>
                <div class="about-item">
                    <h3>Rigorous Peer Review</h3>
                    <p>Multi-round review process with specialized AI reviewers ensuring accuracy, completeness, and technical validity</p>
                </div>
                <div class="about-item">
                    <h3>Editorial Standards</h3>
                    <p>Only research meeting our quality threshold (7.0/10) gets published. Rejected submissions are available for transparency</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid-4">
                <div class="footer-section">
                    <div class="footer-brand">Autonomous Research Press</div>
                    <p>AI-powered academic research platform with rigorous multi-agent peer review and transparent editorial standards.</p>
                </div>
                <div class="footer-section">
                    <h4>Platform</h4>
                    <ul>
                        <li><a href="about.html">About</a></li>
                        <li><a href="submit.html">Submit Manuscript</a></li>
                        <li><a href="my-research.html">My Research</a></li>
                        <li><a href="login.html">Login</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="research-queue.html">Research Queue</a></li>
                        <li><a href="ask-topic.html">Ask Research</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <ul>
                        <li><a href="https://suhyeonlee.xyz">Author</a></li>
                        <li><a href="https://tokamak.network">Tokamak Network</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Autonomous Research Press. All rights reserved. <span id="system-version" style="color: var(--text-secondary); font-size: 0.9em;"></span></p>
                <p class="footer-note">Research reports are AI-generated and peer-reviewed. Verify critical information independently.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let allProjects = [];
        let filteredProjects = [];
        let currentPage = 1;
        const PER_PAGE = 12;
        let searchTimer = null;

        async function loadSystemVersion() {
            const versionEl = document.getElementById('system-version');
            if (versionEl) versionEl.textContent = '';
        }

        async function loadArticles() {
            try {
                const response = await fetch('/api/projects');
                if (!response.ok) return;

                const data = await response.json();
                const projects = data.projects || [];

                let minDate = null;
                try {
                    const settingsResp = await fetch('/api/site-settings');
                    if (settingsResp.ok) {
                        const settings = await settingsResp.json();
                        minDate = settings.min_date || null;
                    }
                } catch (e) {}

                const acceptedProjects = projects
                    .filter(p => p.status === 'completed' && p.passed === true)
                    .filter(p => !minDate || p.timestamp >= minDate);
                allProjects = acceptedProjects;

                updateStatsStrip(acceptedProjects);
                updateHeroBadge(acceptedProjects);
                applyFilters();
            } catch (error) {
                console.error('Error loading articles:', error);
            }
        }

        function updateStatsStrip(projects) {
            document.getElementById('stat-papers').textContent = projects.length || '0';
            if (projects.length > 0) {
                const avgScore = (projects.reduce((sum, p) => sum + (p.final_score || 0), 0) / projects.length).toFixed(1);
                const avgRounds = (projects.reduce((sum, p) => sum + (p.total_rounds || 0), 0) / projects.length).toFixed(1);
                document.getElementById('stat-avg-score').textContent = avgScore;
                document.getElementById('stat-avg-rounds').textContent = avgRounds;
            } else {
                document.getElementById('stat-avg-score').textContent = '--';
                document.getElementById('stat-avg-rounds').textContent = '--';
            }
            document.getElementById('stat-review-type').textContent = 'Multi-Round';
        }

        function updateHeroBadge(projects) {
            const badge = document.getElementById('hero-badge-text');
            if (projects.length > 0) {
                badge.textContent = `${projects.length} Papers Published`;
            } else {
                badge.textContent = 'Accepting Submissions';
            }
        }

        function onSearchInput() {
            clearTimeout(searchTimer);
            searchTimer = setTimeout(() => applyFilters(), 200);
        }

        function applyFilters() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            const sortBy = document.getElementById('sort-select').value;

            let filtered = query
                ? allProjects.filter(p => {
                    const text = ((p.title || '') + ' ' + (p.topic || '') + ' ' + (p.id || '')).toLowerCase();
                    return text.includes(query);
                })
                : [...allProjects];

            if (sortBy === 'score') {
                filtered.sort((a, b) => (b.final_score || 0) - (a.final_score || 0));
            } else if (sortBy === 'rounds') {
                filtered.sort((a, b) => (b.total_rounds || 0) - (a.total_rounds || 0));
            } else {
                filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            }

            filteredProjects = filtered;
            currentPage = 1;
            renderPage();
        }

        function renderPage() {
            const total = filteredProjects.length;
            const totalPages = Math.max(1, Math.ceil(total / PER_PAGE));
            if (currentPage > totalPages) currentPage = totalPages;

            const start = (currentPage - 1) * PER_PAGE;
            const end = Math.min(start + PER_PAGE, total);
            const pageItems = filteredProjects.slice(start, end);

            const grid = document.getElementById('articles-grid');
            if (!grid) return;

            if (total === 0) {
                const query = document.getElementById('search-input').value.trim();
                grid.innerHTML = `<div style="text-align:center;padding:60px 20px;color:var(--text-secondary);grid-column:1/-1;">
                    <p style="font-size:1.1rem;margin-bottom:1rem;">${query ? `No articles found for "${query}"` : 'No published research yet'}</p>
                    <p>${query ? 'Try a different search term.' : 'New research will appear here once it passes peer review.'}</p>
                </div>`;
                document.getElementById('pagination-bar').style.display = 'none';
                return;
            }

            grid.innerHTML = '';
            pageItems.forEach(proj => { grid.innerHTML += createArticleCard(proj); });

            renderPagination(total, totalPages, start + 1, end);
        }

        function renderPagination(total, totalPages, rangeStart, rangeEnd) {
            const bar = document.getElementById('pagination-bar');
            const info = document.getElementById('pagination-info');
            const controls = document.getElementById('pagination-controls');

            if (totalPages <= 1) {
                bar.style.display = 'none';
                return;
            }

            bar.style.display = '';
            info.textContent = `Showing ${rangeStart}\u2013${rangeEnd} of ${total} articles`;

            let html = '';
            html += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})" aria-label="Previous page">&lsaquo;</button>`;

            const pages = getPaginationPages(currentPage, totalPages);
            pages.forEach(p => {
                if (p === '...') {
                    html += `<span class="page-ellipsis">&hellip;</span>`;
                } else {
                    html += `<button class="page-btn${p === currentPage ? ' active' : ''}" onclick="goToPage(${p})">${p}</button>`;
                }
            });

            html += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})" aria-label="Next page">&rsaquo;</button>`;

            controls.innerHTML = html;
        }

        function getPaginationPages(current, total) {
            if (total <= 7) {
                return Array.from({length: total}, (_, i) => i + 1);
            }
            const pages = [];
            pages.push(1);
            if (current > 3) pages.push('...');
            for (let i = Math.max(2, current - 1); i <= Math.min(total - 1, current + 1); i++) {
                pages.push(i);
            }
            if (current < total - 2) pages.push('...');
            pages.push(total);
            return pages;
        }

        function goToPage(n) {
            const totalPages = Math.max(1, Math.ceil(filteredProjects.length / PER_PAGE));
            if (n < 1 || n > totalPages) return;
            currentPage = n;
            renderPage();
            document.getElementById('articles').scrollIntoView({behavior: 'smooth', block: 'start'});
        }

        function createArticleCard(proj) {
            const timestamp = new Date(proj.timestamp);
            const now = new Date();
            const hoursAgo = (now - timestamp) / (1000 * 60 * 60);
            const isNew = hoursAgo < 24;
            const isFeatured = proj.final_score >= 8.0;

            let badgeHtml = '';
            if (isNew) {
                badgeHtml = '<div class="card-badge">New</div>';
            } else if (isFeatured) {
                badgeHtml = '<div class="card-badge">Featured</div>';
            }

            const dateStr = timestamp.toLocaleDateString('en-US', {year: 'numeric', month: 'short', day: 'numeric'});
            const timeStr = timestamp.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false});

            let categoryHtml = '';
            if (proj.category && proj.category.major) {
                const majorDisplay = proj.category.major.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                const subfieldDisplay = proj.category.subfield ? proj.category.subfield.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase()) : '';
                categoryHtml = `<span class="category-tag">${majorDisplay}${subfieldDisplay ? ' / ' + subfieldDisplay : ''}</span>`;
            }

            let researchTypeBadgeHtml = '';
            if (proj.research_type === 'survey') {
                researchTypeBadgeHtml = '<span class="category-tag tag-survey">Survey</span>';
            } else if (proj.research_type === 'explainer') {
                researchTypeBadgeHtml = '<span class="category-tag tag-explainer">Explainer</span>';
            } else if (proj.research_type === 'research') {
                researchTypeBadgeHtml = '<span class="category-tag tag-original">Original</span>';
            }

            let audienceText = '';
            if (proj.audience_level === 'beginner') audienceText = 'Beginner-Friendly';
            else if (proj.audience_level === 'intermediate') audienceText = 'Intermediate';
            else if (proj.audience_level === 'professional') audienceText = 'Professional';

            return `
                <article class="article-card">
                    <div class="card-badges-row">
                        ${badgeHtml}
                        ${researchTypeBadgeHtml}
                        ${categoryHtml}
                    </div>
                    <div class="card-content">
                        <div class="card-meta">
                            <span class="meta-date-mono">${dateStr} ${timeStr}</span>
                            ${audienceText ? `<span class="meta-divider">&middot;</span><span>${audienceText}</span>` : ''}
                            <span class="meta-divider">&middot;</span><span class="meta-version-tag">v${proj.system_version || 'legacy'}</span>
                        </div>
                        <h3 class="card-title">
                            <a href="article.html?id=${proj.id}">${proj.title || proj.topic}</a>
                        </h3>
                        <div class="card-highlights">
                            <div class="highlight-item">
                                <span class="highlight-label">Score</span>
                                <div class="card-score-split">
                                    <span class="score-big">${proj.final_score || '--'}</span>
                                    <span class="score-small">/10</span>
                                </div>
                            </div>
                            <div class="highlight-item">
                                <span class="highlight-label">Review Rounds</span>
                                <span class="highlight-value">${proj.total_rounds}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <a href="article.html?id=${proj.id}" class="card-link">
                            Read Full Report
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </a>
                    </div>
                </article>
            `;
        }

        loadArticles();
        loadSystemVersion();
    </script>
</body>
</html>
