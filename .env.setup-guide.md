# 환경 변수 설정 가이드

## 필수 환경 변수

### 1. Anthropic API Key (필수)
현재 모든 모델(Opus 4.6, Sonnet 4.5, Haiku 4.5)이 Anthropic Claude를 사용하므로 **필수**입니다.

```bash
export ANTHROPIC_API_KEY="sk-ant-api03-your-actual-key-here"
```

또는 `.env` 파일에 추가:
```bash
ANTHROPIC_API_KEY=sk-ant-api03-your-actual-key-here
```

### API Key 발급 방법
1. https://console.anthropic.com/ 접속
2. 로그인 후 "API Keys" 메뉴
3. "Create Key" 클릭
4. 생성된 키 복사 (sk-ant-api03-로 시작)

---

## 선택 환경 변수

### 2. Custom Anthropic Endpoint (선택)
Anthropic 프록시나 커스텀 엔드포인트 사용 시:

```bash
export ANTHROPIC_BASE_URL="https://your-proxy.com/v1"
```

기본값: Anthropic 공식 API (https://api.anthropic.com/)

### 3. 기본 모델 오버라이드 (선택)
`.env` 파일에서 기본 모델 변경 가능:

```bash
DEFAULT_WRITER_MODEL=claude-opus-4-6      # 기본: claude-opus-4-6
DEFAULT_REVIEWER_MODEL=claude-sonnet-4.5   # 기본: claude-sonnet-4.5
```

### 4. 워크플로우 설정 (선택)
```bash
MAX_REVIEW_ROUNDS=3        # 최대 리뷰 라운드 (기본: 3)
SCORE_THRESHOLD=7.5        # 통과 기준 점수 (기본: 7.5)
```

---

## 빠른 시작

1. `.env` 파일 생성:
```bash
cp .env.example .env
```

2. `.env` 파일 편집:
```bash
# 필수: Anthropic API Key만 입력하면 됩니다
ANTHROPIC_API_KEY=sk-ant-api03-your-key-here

# 나머지는 기본값 사용 (주석 처리 가능)
```

3. 테스트:
```bash
# API 연결 확인
ai-research status --check-keys

# 프로바이더 테스트
ai-research test --test-providers
```

---

## 현재 모델 구성 (자동 적용)

| Tier | Primary Model | Fallback | 역할 |
|------|---------------|----------|------|
| **Reasoning** | Opus 4.6 | Sonnet 4.5 | writer, reviewer, moderator |
| **Support** | Sonnet 4.5 | Haiku 4.5 | citation_verifier, coauthor, integration_editor |
| **Light** | Haiku 4.5 | Sonnet 4.5 | author_response, desk_editor, categorizer |

ANTHROPIC_API_KEY만 설정하면 위 3-tier 모델이 자동으로 작동합니다.

---

## 문제 해결

### "API key not found" 에러
```bash
# 환경 변수 확인
echo $ANTHROPIC_API_KEY

# .env 파일 확인
cat .env | grep ANTHROPIC_API_KEY

# 재설정
export ANTHROPIC_API_KEY="sk-ant-api03-..."
```

### 모델 접근 권한 에러
- Opus 4.6 접근 권한이 없으면 자동으로 Sonnet 4.5로 fallback됩니다
- API key의 tier 확인: https://console.anthropic.com/settings/limits

### Rate Limit 에러
- Anthropic API tier별 rate limit 확인
- 요청 간 딜레이 추가하거나 tier 업그레이드 필요
